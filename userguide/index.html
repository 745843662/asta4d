<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Asta4D Framework User Guide</title><link rel="stylesheet" type="text/css" href="css/manual-singlepage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-user-guide"></a>Asta4D Framework User Guide</h1></div><div><div class="authorgroup"><h2>Authors</h2>
      <span class="author"><span class="firstname">Shunsuke</span> <span class="surname">Otani</span></span>	  
      , <span class="author"><span class="firstname">Rui</span> <span class="surname">Liu</span></span>
    </div></div><div><p class="releaseinfo">0.1</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="part"><a href="#asta4d-introduction">I. Introduction of Asta4D</a></span></dt><dt><span class="part"><a href="#asta4d-functionality">II. Functions of Asta4D</a></span></dt></dl></div>
  

  

  

  <div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-introduction"></a>Part&nbsp;I.&nbsp;Introduction of Asta4D</h1></div></div></div>
    

    <div class="partintro"><div></div>
      <p>Asta4D is a web application framework which is friendly to design and flexible to development.</p>
      
      <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>1.&nbsp;Overview of Asta4D</h2></div></div></div>
  

  <p>Asta4D is inspired by lift which is a famous scala web application framework. Asta4D is therefore 
  developed as an alternative of lift for Java. If you like scala, we strongly recommend lift for you 
  and if you&#8216;d like to enjoy the benefit of lift while still staying with Java, we believe our Asta4D 
  is your best fit.</p>
  
  <p>In the past decade, plenty of Java based web application frameworks are generated. Especially the MVC 
  architecture and JSP tag libs (or other traditional template technologies) that has greatly released our productivity. 
  But unfortunately, we are still suffering from the following situations:
  </p>
  
  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      <p>The designers or front-end engineers are keeping complaining the mixed-in dynamic code, as they disturb 
      their efforts of redesigning the page style or structure. And in the mean time, the back-end developers are also 
      complaining that the front-end guys break the working page frequently,  because redesign or the new design is hard 
      to merge due to the huge cost of source refactoring. </p>
    </li><li class="listitem">
      <p>The developers are complaining about the poor functionalities of template language which they are using 
      and tired from the various magic skills for complex rendering logic.</p>
    </li><li class="listitem">
      <p>3.	The developers are discontented with the counterproductivity of MVC architecture and desire a more efficient 
      approach like traditional PHP/ASP development.</p>
    </li></ul></div>
  
  <p>Asta4D is our solution to combat those issues. Thanks to lift, from where we learn a lot, and try to bring them into the Java&#8217;s world. 
  We designed Asta4D complying with the following points:
  </p>
  
  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      <p>Separate template and rendering logic</p>
	  <p>There is no dynamic code in template file. An Asta4D template file is always a pure HTML file which can be easily maintained by 
      front-end developers, it is very design friendly and we can reduce the workload for source refactoring by over 90%. 
	  </p>
      
      <pre class="programlisting">

&lt;section&gt;
	&lt;article&gt;
		&lt;div afd:render=<span class="hl-string">"SimpleSnippet"</span>&gt;dummy text&lt;/div&gt;
		&lt;afd:snippet render=<span class="hl-string">"SimpleSnippet:setProfile"</span>&gt;
			&lt;p id=<span class="hl-string">"name"</span>&gt;name:&lt;span&gt;dummy name&lt;/span&gt;&lt;/p&gt;
			&lt;p id=<span class="hl-string">"age"</span>&gt;age:&lt;span&gt;<span class="hl-number">0</span>&lt;/span&gt;&lt;/p&gt;
		&lt;/afd:snippet&gt;
	&lt;/article&gt;
&lt;/section&gt;

      </pre>      
      
      
	  <p>The rendering logic is secluded to an independent java class, developers do not need to learn any new template language, they can continue to use 
      their familiar Java to describe how they want to render the page with the full power of Java language.
	  </p>
	  
      <pre class="programlisting">


<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleSnippet {

    <span class="hl-keyword">public</span> Renderer render(String name) {
        <span class="hl-keyword">if</span> (StringUtils.isEmpty(name)) {
            name = <span class="hl-string">"Asta4D"</span>;
        }
        Element element = 
ElementUtil.parseAsSingle(<span class="hl-string">"&lt;span&gt;Hello "</span> + name + <span class="hl-string">"!&lt;/span&gt;"</span>);
        <span class="hl-keyword">return</span> Renderer.create(<span class="hl-string">"*"</span>, element);
    }

    <span class="hl-keyword">public</span> Renderer setProfile() {
        Renderer render = <span class="hl-keyword">new</span> GoThroughRenderer();
        render.add(<span class="hl-string">"p#name span"</span>, <span class="hl-string">"asta4d"</span>);
        render.add(<span class="hl-string">"p#age span"</span>, <span class="hl-string">"20"</span>);
        <span class="hl-keyword">return</span> render;
    }
}


      </pre>
	  
    </li><li class="listitem">
      <p>View first without controller and a powerful and easy to use URL matching mechanism</p>
      <p>We agree with that MVC is a great and powerful architecture, but it is counterproductive. For years, Java programmers have been 
      desiring for a solution that is efficient to develop like traditional PHP/ASP development. The essential reason of why traditional 
      PHP/ASP development is efficient is the answer called &#8220;View First&#8221;. In a view first developing style, a developer will implement the 
      logic at where the result is supposed to be shown, which is how the traditional PHP/ASP development performs. 
      </p>
      
      <p>Many people would argue that the implementation on site will cause the source becomes more complex and hard to understand. 
      This is not wrong, but we have separated our template file from rendering logic, so it is no longer a problem. In terms of productivity, 
      the developers can therefore concentrate on the real development without worrying about complicating source structure.
      </p>
      
      <p>We also supply a powerful and easy way to configure URL matching rules with a sort of human friendly configuration api.</p>

      <pre class="programlisting">


        rules.add(<span class="hl-string">"/app/"</span>, <span class="hl-string">"/templates/index.html"</span>);

        rules.add(<span class="hl-string">"/app/handler"</span>)
             .handler(LoginHandler.<span class="hl-keyword">class</span>)
             .handler(EchoHandler.<span class="hl-keyword">class</span>)
             .forward(LoginFailure.<span class="hl-keyword">class</span>, <span class="hl-string">"/templates/error.html"</span>)
             .forward(<span class="hl-string">"/templates/success.html"</span>);



      </pre>
      
    </li><li class="listitem">
      <p>Simple but flexible process flow</p>
      
      <p>There is no controller in our framework, we believe there should be a certain party which should take the responsibility of 
      a certain request, we called the certain party as request handlers. We assume that a sort of request handlers will try to supply 
      certain content to the client who sends the request, so a request handler will supply a content provider which will produce the real 
      content and then a content writer will take the obligation of writing the content back to the client.</p>
      
      <p>Thus, an ajax or Restful request can be simply forwarded to a request handler which will supply the result. </p>
      
      <p>JSON:</p>
      <pre class="programlisting">


rules.add(<span class="hl-string">"/app/ajax/getUserList"</span>).handler(GetUserListHandler.<span class="hl-keyword">class</span>).json();

<span class="hl-comment">//...</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> GetUserListHandler {

    <em><span class="hl-annotation" style="color: gray">@RequestHandler</span></em>
    <span class="hl-keyword">public</span> List&lt;String&gt; queryUserList() {
        <span class="hl-keyword">return</span> Arrays.asList(<span class="hl-string">"otani"</span>, <span class="hl-string">"ryu"</span>, <span class="hl-string">"mizuhara"</span>);
    }
}



      </pre>

      <p>Restful:</p>
      <pre class="programlisting">


rules.add(PUT, <span class="hl-string">"/app/ajax/addUser"</span>).handler(AddUserHandler.<span class="hl-keyword">class</span>).rest();

<span class="hl-comment">//...</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AddUserHandler {

    <em><span class="hl-annotation" style="color: gray">@RequestHandler</span></em>
    <span class="hl-keyword">public</span> HeaderInfo doAdd(String newUserName) {
        <span class="hl-comment">// some logic that should add a new user by the given name</span>
        <span class="hl-comment">// ...</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> HeaderInfo(<span class="hl-number">200</span>);
    }
}



      </pre>

    </li><li class="listitem">
      <p>Isolate side effect with request handler and multi-threaded page rendering</p>
      
      <p>There are two types of action in a system, one is with &#8220;side effect&#8221;, another one is without &#8220;side effect&#8221;. 
      &#8220;actions with side effect&#8221; are ones that will change the system status once they are performed. For instance, 
      for the same URL, a login request (if succeeded) will cause a client&#8217;s privilege to be changed and the client 
      could probably get a different page view from what the client get before login, because of which we say a login 
      request is an action with side effect. Another obvious example is a database update operation. Once an update is 
      committed, all the related clients will get a different output from the result before the update, which is also 
      classified as &#8220;an action with side effect&#8221;. How about a query? We consider a query as an operation without side effect, 
      it means that a client will always get the same result regardless of how many times the query is executed.</p>
      
      <p>We believe the actions with side effect should be managed seriously and we do that by putting all the actions 
      with side effect to request handlers so that the view layer is purified and this makes the source more clear and maintainable. 
      This is also means with Asta4D we can easily perform multi thread rendering on a single page because they are now all side-effect free.
      </p>
      
      <p>paralle snippet rendering:</p>
      <pre class="programlisting">


&lt;div afd:render=<span class="hl-string">"ParallelTest$TestRender:snippetInDiv"</span> afd:parallel&gt;
    &lt;div id=<span class="hl-string">"test"</span>&gt;xx&lt;/div&gt;
&lt;/div&gt;

&lt;afd:snippet render=<span class="hl-string">"ParallelTest$TestRender:snippetReplaceDiv"</span> parallel&gt;
    &lt;div id=<span class="hl-string">"test"</span>&gt;xx&lt;/div&gt;
&lt;/afd:snippet&gt;



      </pre>      
      
      <p>parallel list rendering:</p>
      <pre class="programlisting">


Renderer renderer = Renderer.create(<span class="hl-string">"div#test"</span>, list, <span class="hl-keyword">new</span> ParallelDataConvertor&lt;String, String&gt;() {
                <em><span class="hl-annotation" style="color: gray">@Override</span></em>
                <span class="hl-keyword">public</span> String convert(String obj) {
                    <span class="hl-keyword">try</span> {
                        Thread.sleep(<span class="hl-number">1000</span>);
                    } <span class="hl-keyword">catch</span> (InterruptedException e) {
                        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException(e);
                    }
                    <span class="hl-keyword">return</span> obj + <span class="hl-string">"-sleep"</span>;
                }
            });




      </pre> 
      
    </li></ul></div> 
  
</div>
      

    </div>
  </div>
  
  <div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-functionality"></a>Part&nbsp;II.&nbsp;Functions of Asta4D</h1></div></div></div>
    
    <p>...</p>
  </div>  
  
</div></body></html>