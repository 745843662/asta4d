<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Asta4D Framework User Guide</title><link rel="stylesheet" type="text/css" href="css/manual-singlepage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-user-guide"></a>Asta4D Framework User Guide</h1></div><div><div class="authorgroup"><h2>Authors</h2>
      <span class="author"><span class="firstname">Shunsuke</span> <span class="surname">Otani</span></span>	  
      , <span class="author"><span class="firstname">Rui</span> <span class="surname">Liu</span></span>
    </div></div><div><p class="releaseinfo">0.1</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="part"><a href="#asta4d-introduction">I. Introduction</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chapter-intro">1. Why Asta4D</a></span></dt></dl></dd><dt><span class="part"><a href="#asta4d-user-guide">II. User Guide</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chapter-Inheritable-template">2. Flexible template</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e55">2.1. Inheritable template</a></span></dt><dt><span class="section"><a href="#d5e79">2.2. Parameterized embeding</a></span></dt></dl></dd><dt><span class="chapter"><a href="#splitted-rendering">3. Splitted rendering logic from template</a></span></dt><dt><span class="chapter"><a href="#renderer">4. Renderer: easy to use, secure, testable</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e113">4.1. How to render data to page</a></span></dt><dt><span class="section"><a href="#d5e131">4.2. Immune from cross-site hole</a></span></dt><dt><span class="section"><a href="#d5e134">4.3. Test your rendering logic</a></span></dt></dl></dd><dt><span class="chapter"><a href="#overview">5. View first URL mapping and variable injection</a></span></dt><dt><span class="chapter"><a href="#overview">6. Side-effect and request handler</a></span></dt><dt><span class="chapter"><a href="#overview">7. Impement request handler and url mapping</a></span></dt></dl></dd><dt><span class="part"><a href="#asta4d-reference">III. Reference</a></span></dt><dd><dl><dt><span class="chapter"><a href="#overview">8. Template</a></span></dt><dt><span class="chapter"><a href="#overview">9. Snippet</a></span></dt><dt><span class="chapter"><a href="#overview">10. Variable injection</a></span></dt><dt><span class="chapter"><a href="#overview">11. URL rule</a></span></dt><dt><span class="chapter"><a href="#overview">12. Request Handler</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e168">12.1. Implementation</a></span></dt><dt><span class="section"><a href="#d5e170">12.2. Content provider</a></span></dt><dt><span class="section"><a href="#d5e172">12.3. Request handler chain</a></span></dt><dt><span class="section"><a href="#d5e174">12.4. Request Interceptor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#overview">13. Extended request handler usage</a></span></dt><dd><dl><dt><span class="section"><a href="#d5e178">13.1. Restful</a></span></dt><dt><span class="section"><a href="#d5e180">13.2. Handle static resouce files and generic path mapping</a></span></dt><dt><span class="section"><a href="#d5e182">13.3. Normalize http request</a></span></dt><dt><span class="section"><a href="#d5e184">13.4. As MVC's Controller</a></span></dt></dl></dd><dt><span class="chapter"><a href="#overview">14. i18n</a></span></dt><dt><span class="chapter"><a href="#overview">15. Asta4dServlet and configuration</a></span></dt><dt><span class="chapter"><a href="#overview">16. Integration with Spring</a></span></dt></dl></dd></dl></div>
  

  

  

  <div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-introduction"></a>Part&nbsp;I.&nbsp;Introduction</h1></div></div></div>
    
    
    <div class="partintro"><div></div>
      <p>
      Asta4D is a web application framework which is friendly to designer and flexible to developer. Asta4D affords
      high productivity than traditional MVC architecture by View First architecture. It also allows front-end engineers 
      and back-end engineers work independently without interference by separating rendering logic from template files.
      </p>
      
      <p>
      Asta4D is inspired by lift which is a famous scala web application framework and it is developed by astamuse company Ltd.
      locating at Tokyo Japan. We are concentrating on global innovation support and developing Asta4D for our own services.
      Currently, Asta4D is driving our new service development.

      </p>
    </div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="chapter-intro"></a>1.&nbsp;Why Asta4D</h2></div></div></div>
  
  
  <p>In the past decade, plenty of Java based web application frameworks are generated. Especially the MVC 
  architecture and JSP tag libs (or other traditional template technologies) that has greatly released our productivity. 
  But unfortunately, we are still suffering from the following situations:
  </p>
  
  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      <p>The designers or front-end engineers are keeping complaining the mixed-in dynamic code, as they disturb 
      their efforts of redesigning the page style or structure. And in the mean time, the back-end developers are also 
      complaining that the front-end guys break the working page frequently,  because redesign or the new design is hard 
      to merge due to the huge cost of source refactoring. </p>
    </li><li class="listitem">
      <p>The developers are complaining about the poor functionalities of template language which they are using 
      and tired from the various magic skills for complex rendering logic.</p>
    </li><li class="listitem">
      <p>3.	The developers are discontented with the counterproductivity of MVC architecture and desire a more efficient 
      approach like traditional PHP/ASP development.</p>
    </li></ul></div>
  
  <p>Asta4D is our solution to combat those issues. Thanks to lift, from where we learn a lot. We designed Asta4D complying
  with the following points:
  </p>
  
  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      <p>Separate template and rendering logic</p>
      <p>Asta4D affords front-end engineers a friendly environment by separating rendering logic from template files which
      are pure html files. At the mean time, back-end engineers can use the powerful Java language to implement the rendering
      logic without being suffering from the "poor and sometimes magic" template languages.
      </p>
    </li><li class="listitem">
      <p>View first without controller</p>
      <p>Asta4D also affords higher productivity than traditional MVC architecture by View First mechanism. And it is also
      easier to change than MVC architecture.</p>
    </li><li class="listitem">
      <p>Isolate side effect with request handler</p>
      <p>Asta4D imports the conception of "side-effect" from functional programming languages and separating the "side-effect"
      by request handlers, which afford more flexibility on page rendering because the view layer is side-effect free now. Therefore
      Asta4D allows parallel page rendering in multiple threads as a built-in feature.
      </p>
    </li></ul></div>

  <p>The name of Asta4D is from our company's name: astamuse. We explain the "4D" as following ways:</p> 
  
  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      <p>For Designer</p>
      <p>Asta4D consider the design friendliness as the most important factor of itself. We hope web designers can fulfil their
      maximum potential of creativity without squandering their time on the back-end technologies which they could never be adept at.
      </p>
    </li><li class="listitem">
      <p>For developer</p>
      <p>We hope Asta4D can help developers to achieve their work more easily. Developers would never be afflicted with complex
      rendering logic because they can use powerful Java language to do whatever they want since the rendering has been splitted from
      template files. View first also releases developers from the cumbersome MVC architecture, now they have more time to have a cup
      of coffee.</p>
    </li><li class="listitem">
      <p>4 Dimension</p>
      <p>We believe that Asta4D can act as a wormhole that connects the front-end and the back-end. We can move quicker by Asta4D just
      like we are going through the 4 dimensional space.
      </p>
    </li></ul></div>
</div>
  </div>

  <div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-user-guide"></a>Part&nbsp;II.&nbsp;User Guide</h1></div></div></div>
    
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="chapter-Inheritable-template"></a>2.&nbsp;Flexible template</h2></div></div></div>
  
  
    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e55"></a>2.1&nbsp;Inheritable template</h2></div></div></div>
      
      <p>
      The template of Asta4D is inheritable, child template can override, append or insert content to certain place
      in parent template. Let's see a sample:
      </p>
      <div class="example"><a name="d5e58"></a><p class="title"><b>Example&nbsp;2.1.&nbsp;parent.html</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;html&gt;</span>   
    <span class="hl-tag">&lt;head&gt;</span>   
        <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">id</span>=<span class="hl-value">"block1"</span><span class="hl-tag">&gt;</span>   
            <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"parent1.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
        <span class="hl-tag">&lt;/afd:block&gt;</span>   
           
        <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">id</span>=<span class="hl-value">"block2"</span><span class="hl-tag">&gt;</span>   
            <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"parent2.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
        <span class="hl-tag">&lt;/afd:block&gt;</span>   
  
        <span class="hl-tag">&lt;title&gt;</span>extension sample<span class="hl-tag">&lt;/title&gt;</span>   
    <span class="hl-tag">&lt;/head&gt;</span>   
    <span class="hl-tag">&lt;body&gt;</span>   
        <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">id</span>=<span class="hl-value">"content"</span><span class="hl-tag">&gt;</span>content<span class="hl-tag">&lt;/afd:block&gt;</span>   
    <span class="hl-tag">&lt;/body&gt;</span>   
<span class="hl-tag">&lt;/html&gt;</span>

      </pre>
      </div></div><br class="example-break">

      <p>Child template can declare inheritance by "afd:extension" and overriding can be declared by "afd:block":</p>
      <div class="example"><a name="template-child"></a><p class="title"><b>Example&nbsp;2.2.&nbsp;child.html</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;html&gt;</span>   
<span class="hl-tag">&lt;head&gt;</span><span class="hl-tag">&lt;/head&gt;</span>   
<span class="hl-tag">&lt;body&gt;</span>   
<span class="hl-comment">&lt;!-- (1) --&gt;</span>   
<span class="hl-tag">&lt;afd:extension</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"parent.html"</span><span class="hl-tag">&gt;</span>   
  
    <span class="hl-comment">&lt;!-- (2) --&gt;</span>   
    <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">append</span>=<span class="hl-value">"block1"</span><span class="hl-tag">&gt;</span>   
        <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"child1.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
    <span class="hl-tag">&lt;/afd:block&gt;</span>   
  
    <span class="hl-comment">&lt;!-- (3) --&gt;</span>   
    <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">insert</span>=<span class="hl-value">"block2"</span><span class="hl-tag">&gt;</span>   
        <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"child2.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
    <span class="hl-tag">&lt;/afd:block&gt;</span>   
  
    <span class="hl-comment">&lt;!-- (4) --&gt;</span>   
    <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">override</span>=<span class="hl-value">"content "</span><span class="hl-tag">&gt;</span>   
        <span class="hl-tag">&lt;div&gt;</span>hello<span class="hl-tag">&lt;/div&gt;</span>   
        <span class="hl-comment">&lt;!-- (5) --&gt;</span>   
        <span class="hl-tag">&lt;afd:embed</span> <span class="hl-attribute">target</span>=<span class="hl-value">"/templates/embed.html"</span><span class="hl-tag"> &gt;</span><span class="hl-tag">&lt;/afd:embed&gt;</span>   
    <span class="hl-tag">&lt;/afd:block&gt;</span>   
  
<span class="hl-tag">&lt;/afd:extension&gt;</span>   
<span class="hl-tag">&lt;/body&gt;</span>   
<span class="hl-tag">&lt;/html&gt;</span> 

      </pre>
      </div></div><br class="example-break">
      
      <p>
      "afd:block" support 3 types action: insert, append and override. 
      </p>
      
      <br>
      
      <p>
      In the <a class="xref" href="#template-child" title="Example&nbsp;2.2.&nbsp;child.html">Example&nbsp;2.2, &#8220;child.html&#8221;</a>, there is an additional declaration of including by "afd:embed" which embed 
      the target file to the current place of the current file. Let's see the embed.html:
      </p>
      <div class="example"><a name="template-child"></a><p class="title"><b>Example&nbsp;2.3.&nbsp;embed.html</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;html&gt;</span>   
<span class="hl-tag">&lt;head&gt;</span><span class="hl-tag">&lt;/head&gt;</span>   
<span class="hl-tag">&lt;body&gt;</span>   
    <span class="hl-comment">&lt;!-- (6) --&gt;</span>   
    <span class="hl-tag">&lt;afd:block</span> <span class="hl-attribute">append</span>=<span class="hl-value">"block1"</span><span class="hl-tag">&gt;</span>   
        <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"embed.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
    <span class="hl-tag">&lt;/afd:block&gt;</span>   
    <span class="hl-tag">&lt;div&gt;</span>good embed<span class="hl-tag">&lt;/div&gt;</span>   
<span class="hl-tag">&lt;/body&gt;</span>   
<span class="hl-tag">&lt;/html&gt;</span>   

      </pre>
      </div></div><br class="example-break">
      
      <p>
      The "afd:block" declaration in the embeded target file is available after the content of target file is inserted into the
      <a class="xref" href="#template-child" title="Example&nbsp;2.2.&nbsp;child.html">Example&nbsp;2.2, &#8220;child.html&#8221;</a>, all "afd:block" tags will be treated as overriding(inserting/appending) to the parent template
      and the contents out of "afd:blocks" will be inserted at the place where the "afd:embed" is declared.
      </p>
      
      <br>
      
      <p>After all the template files are merged, we will get the following result:</p>
      <div class="example"><a name="d5e76"></a><p class="title"><b>Example&nbsp;2.4.&nbsp;The result of template merging:</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;html&gt;</span>   
<span class="hl-tag">&lt;head&gt;</span>   
       
    <span class="hl-comment">&lt;!-- block1 --&gt;</span>   
    <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"parent1.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
    <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"child1.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
    <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"embed.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
  
    <span class="hl-comment">&lt;!-- block2 --&gt;</span>   
    <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"child2.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
    <span class="hl-tag">&lt;link</span> <span class="hl-attribute">href</span>=<span class="hl-value">"parent2.css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span><span class="hl-tag"> /&gt;</span>   
  
    <span class="hl-tag">&lt;title&gt;</span>extension sample<span class="hl-tag">&lt;/title&gt;</span>   
  
<span class="hl-tag">&lt;/head&gt;</span>   
<span class="hl-tag">&lt;body&gt;</span>   
  
    <span class="hl-comment">&lt;!-- content --&gt;</span>   
    <span class="hl-tag">&lt;div&gt;</span>hello<span class="hl-tag">&lt;/div&gt;</span>   
  
    <span class="hl-comment">&lt;!-- embed --&gt;</span>   
    <span class="hl-tag">&lt;div&gt;</span>good embed<span class="hl-tag">&lt;/div&gt;</span>   
  
<span class="hl-tag">&lt;/body&gt;</span>   
<span class="hl-tag">&lt;/html&gt;</span>  

      </pre>
      </div></div><br class="example-break">
      
      
    </div>

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e79"></a>2.2&nbsp;Parameterized embeding</h2></div></div></div>
      
      
      <p>
      Extra parameters can be passed to the target embeded file by specifying the DOM attribute of "afd:embed" when we
      are embeding files.
      </p>
      
      <div class="example"><a name="d5e82"></a><p class="title"><b>Example&nbsp;2.5.&nbsp;Sample of parameterized embeding:</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;afd:embed</span> <span class="hl-attribute">target</span>=<span class="hl-value">"/xxx/showList.html"</span> <span class="hl-attribute">limit</span>=<span class="hl-value">"30"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/afd:embed&gt;</span>

      </pre>
      </div></div><br class="example-break">

      <p>
      The "limit" parameter can be accessed by variable injection in the rendering logic of showList.html, by which we can
      parameterize the embeding. This feature is very useful for creating a page component which encapsulates common
      html snippets and can be controlled by the passed parameters. Basically, embeding a file in a template file
      is similar to calling a function with(or without) arguments. Especially, the parameters are not limited to
      specified static values in the template file, they can be valued dynamicaly at runtime too. Further, the
      type of parameters is not restricted to the stringizable types such as String or Integer/Long, arbitrary Java type
      can be specified dynamically at runtime. See the reference of Renering logic to learn more details. 
      </p>
    </div>

  <p>
  Simply, the idea of Asta4D's template system is akin to the traditional OOP model, the parent and child templates can be 
  regarded as parent/child classes and the block can be viewed as a overridable virtual method. The embed external files can
  be also treated as funcation calling. As a matter of fact, since arbitrary type of value can be passed to the embed files, 
  there is actually no difference between Asta4D's embeding and common function calling.
  </p>
</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="splitted-rendering"></a>3.&nbsp;Splitted rendering logic from template</h2></div></div></div>
  
  
  <p>
  There is no dynamic code in a template file. An Asta4D template file is always a pure HTML file which can be easily 
  maintained by front-end developers, it is very design friendly and we can reduce the workload for source 
  refactoring by over 90%.
  </p>
  
  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      <p>Declare snippet class in template file</p>
      <div class="example"><a name="d5e93"></a><p class="title"><b>Example&nbsp;3.1.&nbsp;Sample of snippet declaration:</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;section&gt;</span>  
    <span class="hl-tag">&lt;article&gt;</span>  
        <span class="hl-tag">&lt;div</span> <span class="hl-attribute">afd:render</span>=<span class="hl-value">"SimpleSnippet"</span><span class="hl-tag">&gt;</span>dummy text<span class="hl-tag">&lt;/div&gt;</span>  
        <span class="hl-tag">&lt;afd:snippet</span> <span class="hl-attribute">render</span>=<span class="hl-value">"SimpleSnippet:setProfile"</span><span class="hl-tag">&gt;</span>  
            <span class="hl-tag">&lt;p</span> <span class="hl-attribute">id</span>=<span class="hl-value">"name"</span><span class="hl-tag">&gt;</span>name:<span class="hl-tag">&lt;span&gt;</span>dummy name<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/p&gt;</span>  
            <span class="hl-tag">&lt;p</span> <span class="hl-attribute">id</span>=<span class="hl-value">"age"</span><span class="hl-tag">&gt;</span>age:<span class="hl-tag">&lt;span&gt;</span>0<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/p&gt;</span>  
        <span class="hl-tag">&lt;/afd:snippet&gt;</span>  
    <span class="hl-tag">&lt;/article&gt;</span>  
<span class="hl-tag">&lt;/section&gt;</span>

      </pre>
      </div></div><br class="example-break">
  
      <p>
      The "afd:render" attribute in div tag declares a Java class which is in charge of the concrete rendering logic, such Java
      class is usually called as a snippet class. A snippet class can be declared by a "afd:snippet" tag too, as you have seen
      in above sample. The rendering logic is secluded to independent Java classes by snippet declaration and it is not necessary
      to learn any new template language for back-end developers. The back-end guys can achieve all the rendering logic easily
      by powerful Java language which they have been adept to, no learning costs, no magic codes, succinct Java source only.
      </p>
      
      <br>
      
    </li><li class="listitem">
      <p>Implement a snippet class</p>
      <div class="example"><a name="d5e100"></a><p class="title"><b>Example&nbsp;3.2.&nbsp;Sample of snippet class:</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleSnippet {  
  
    <span class="hl-keyword">public</span> Renderer render(String name) {  
        <span class="hl-keyword">if</span> (StringUtils.isEmpty(name)) {  
            name = <span class="hl-string">"Asta4D"</span>;  
        }  
        Element element = ElementUtil.parseAsSingle(<span class="hl-string">"&lt;span&gt;Hello "</span> + name + <span class="hl-string">"!&lt;/span&gt;"</span>);  
        <span class="hl-keyword">return</span> Renderer.create(<span class="hl-string">"*"</span>, element);  
    }  
  
    <span class="hl-keyword">public</span> Renderer setProfile() {  
        Renderer render = <span class="hl-keyword">new</span> GoThroughRenderer();  
        render.add(<span class="hl-string">"p#name span"</span>, <span class="hl-string">"asta4d"</span>);  
        render.add(<span class="hl-string">"p#age span"</span>, <span class="hl-number">20</span>);  
        <span class="hl-keyword">return</span> render;  
    }  
}

      </pre>
      </div></div><br class="example-break">
      
      <p>
      The Renderer class is provided by framework to declare rendering actions. Renderer uses traditional CSS selector to
      reference the rendering target and receive the rendering value at the same time, amazing and powerful.
      </p>
      <br>
      
      <p>If the above template file and snippet class are executed, we would get the following result:</p>
      <div class="example"><a name="d5e106"></a><p class="title"><b>Example&nbsp;3.3.&nbsp;Result of snippet execution:</b></p><div class="example-contents">
      <pre class="programlisting">

<span class="hl-tag">&lt;section&gt;</span>  
    <span class="hl-tag">&lt;article&gt;</span>  
        <span class="hl-tag">&lt;span&gt;</span>Hello Asta4D<span class="hl-tag">&lt;/span&gt;</span>  
            <span class="hl-tag">&lt;p</span> <span class="hl-attribute">id</span>=<span class="hl-value">"name"</span><span class="hl-tag">&gt;</span>name:<span class="hl-tag">&lt;span&gt;</span>asta4d/span&gt;<span class="hl-tag">&lt;/p&gt;</span>  
            <span class="hl-tag">&lt;p</span> <span class="hl-attribute">id</span>=<span class="hl-value">"age"</span><span class="hl-tag">&gt;</span>age:<span class="hl-tag">&lt;span&gt;</span>20<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/p&gt;</span>  
    <span class="hl-tag">&lt;/article&gt;</span>  
<span class="hl-tag">&lt;/section&gt;</span>

      </pre>
      </div></div><br class="example-break">
    </li></ul></div>

  <p>
  Asta4D introduces 4 extra tags to the html template file: afd:extension, afd:block, afd:embed, afd:snippet, which will not
  disturb most html editors, accordingly Asta4D is extremely friendly to front-end engineers. On the other hand, we can see
  that all the rendering logic is fulfiled by Java code and the back-end engineers can compose their back-end logic and rendering logic
  very smoothly without magic skills and extra learning costs, which means highly boost of productivity.
  </p>
  
</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="renderer"></a>4.&nbsp;Renderer: easy to use, secure, testable</h2></div></div></div>
  
  
  <p>
  In Asta4D, all the rendering logic is declared by a Renderer class which provide various interface for rendering.
  </p>
  
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e113"></a>4.1&nbsp;How to render data to page</h2></div></div></div>
    
    <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
        <p>Renderer accepts various types as rendering value</p>
        <div class="example"><a name="d5e118"></a><p class="title"><b>Example&nbsp;4.1.&nbsp;Sample usage of Renderer</b></p><div class="example-contents">
        <pre class="programlisting">

Renderer render = <span class="hl-keyword">new</span> GoThroughRenderer();  
render.add(<span class="hl-string">"#someIdForInt"</span>, <span class="hl-number">12345</span>);  
render.add(<span class="hl-string">"#someIdForLong"</span>, <span class="hl-number">12345L</span>);  
render.add(<span class="hl-string">"#someIdForBool"</span>, true);  
render.add(<span class="hl-string">"#someIdForStr"</span>, <span class="hl-string">"a str"</span>);  
render.add(<span class="hl-string">"#someIdForNull"</span>, (Object) null);  
render.add(<span class="hl-string">"#someIdForClear"</span>, Clear);  
  
Element newChild = ElementUtil.parseAsSingle(<span class="hl-string">"&lt;div&gt;&lt;/div&gt;"</span>);  
render.add(<span class="hl-string">"#someIdForElementSetter"</span>, <span class="hl-keyword">new</span> ChildReplacer(newChild));  
  
render.add(<span class="hl-string">"#someIdForElement"</span>, ElementUtil.parseAsSingle(<span class="hl-string">"&lt;div&gt;eee&lt;/div&gt;"</span>));  
  
render.add(<span class="hl-string">"#someIdForRenderer"</span>, Renderer.create(<span class="hl-string">"#value"</span>, <span class="hl-string">"value"</span>));  

        </pre>
        </div></div><br class="example-break">
      </li><li class="listitem">
        <p>List of data can be rendered via Renderer too:</p>
        <div class="example"><a name="d5e123"></a><p class="title"><b>Example&nbsp;4.2.&nbsp;Sample of list rendering</b></p><div class="example-contents">
        <pre class="programlisting">

Renderer render = <span class="hl-keyword">new</span> GoThroughRenderer();  
render.add(<span class="hl-string">"#someIdForInt"</span>, Arrays.asList(<span class="hl-number">123</span>, <span class="hl-number">456</span>, <span class="hl-number">789</span>));  
render.add(<span class="hl-string">"#someIdForLong"</span>, Arrays.asList(<span class="hl-number">123L</span>, <span class="hl-number">456L</span>, <span class="hl-number">789L</span>));  
render.add(<span class="hl-string">"#someIdForBool"</span>, Arrays.asList(true, true, false));  
render.add(<span class="hl-string">"#someIdForStr"</span>, Arrays.asList(<span class="hl-string">"str1"</span>, <span class="hl-string">"str2"</span>, <span class="hl-string">"str3"</span>));  
  
Element newChild1 = ElementUtil.parseAsSingle(<span class="hl-string">"&lt;div&gt;1&lt;/div&gt;"</span>);  
Element newChild2 = ElementUtil.parseAsSingle(<span class="hl-string">"&lt;div&gt;2&lt;/div&gt;"</span>);  
  
render.add(<span class="hl-string">"#someIdForElementSetter"</span>, Arrays.asList(<span class="hl-keyword">new</span> ChildReplacer(newChild1), <span class="hl-keyword">new</span> ChildReplacer(newChild2)));  
  
render.add(<span class="hl-string">"#someIdForElement"</span>, Arrays.asList(newChild1, newChild2));  
  
render.add(<span class="hl-string">"#someIdForRenderer"</span>, Arrays.asList(<span class="hl-number">123</span>, <span class="hl-number">456</span>, <span class="hl-number">789</span>), <span class="hl-keyword">new</span> RowRenderer&lt;Integer&gt;() {  
    <em><span class="hl-annotation" style="color: gray">@Override</span></em>  
    <span class="hl-keyword">public</span> Renderer convert(<span class="hl-keyword">int</span> rowIndex, Integer obj) {  
        <span class="hl-keyword">return</span> Renderer.create(<span class="hl-string">"#id"</span>, <span class="hl-string">"id-"</span> + obj).add(<span class="hl-string">"#otherId"</span>, <span class="hl-string">"otherId-"</span> + obj);  
    }  
});   

        </pre>
        </div></div><br class="example-break">
      </li><li class="listitem">
        <p>DOM attribution can be done too:</p>
        <div class="example"><a name="d5e128"></a><p class="title"><b>Example&nbsp;4.3.&nbsp;Sample of DOM attribution rendering</b></p><div class="example-contents">
        <pre class="programlisting">

render.add(<span class="hl-string">"#id"</span>, <span class="hl-string">"+class"</span>, <span class="hl-string">"yyy"</span>);  
render.add(<span class="hl-string">"#id"</span>, <span class="hl-string">"-class"</span>, <span class="hl-string">"zzz"</span>);  
  
render.add(<span class="hl-string">"#id"</span>, <span class="hl-string">"+class"</span>, <span class="hl-string">"xxx"</span>);  
  
render.add(<span class="hl-string">"#id"</span>, <span class="hl-string">"value"</span>, <span class="hl-string">"hg"</span>);  
render.add(<span class="hl-string">"#id"</span>, <span class="hl-string">"href"</span>, null);  
  
render.add(<span class="hl-string">"#X"</span>, <span class="hl-string">"value"</span>, <span class="hl-keyword">new</span> Date(<span class="hl-number">123456L</span>));

        </pre>
        </div></div><br class="example-break">
      </li></ul></div>
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e131"></a>4.2&nbsp;Immune from cross-site hole</h2></div></div></div>
    
    <p>
    The previous samples show us that all the operations to DOM are delegated by Renderer except create DOM
    from String value by "ElementUtil#parseAsSingle". As a matter of fact, all the delegated operations cause
    all the rendering values are escaped by force, which means that your system is, by nature, immune from
    cross-site problems if there is no "ElementUtil#parseAsSingle" calling in your system. You do not need
    to be wary of illegal characters by from the clients since all the values will be escaped as HTML compulsorily.
    </p>
    
    On the other hand, according to our practice, it is rarely that you have to call &#8220;ElementUtil.parseAsSingle&#8221;
    to generate the rendering content from a raw HTML string, so just take care of your usage of this exceptional api
    then you can say bye-bye to the cross-site holes.    
  </div>
  
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e134"></a>4.3&nbsp;Test your rendering logic</h2></div></div></div>
    
    <p>
    Testing web page is always a complex task and we usually verify rendering results by selenuim which is as a common
    technology. By Asta4D, testable Renderer can replace over than half of selenium tests to simpler junit tests.
    </p>
    
    <p>
    According to the previous samples, all the rendering logic is holded by an instance of Renderer class, so simply,
    we can verify almost rendering logic by testing the returned Renderer instance from the snippet method. 
    </p>
    
    <div class="example"><a name="d5e138"></a><p class="title"><b>Example&nbsp;4.4.&nbsp;Sample RendererTester</b></p><div class="example-contents">
    <pre class="programlisting">

RendererTester tester = RendererTester.forRenderer(render);  
Assert.assertEquals(tester.get(<span class="hl-string">"#someIdForInt"</span>), <span class="hl-number">12345</span>);  
Assert.assertEquals(tester.get(<span class="hl-string">"#someIdForLong"</span>), <span class="hl-number">12345L</span>);  
Assert.assertEquals(tester.get(<span class="hl-string">"#someIdForBool"</span>), true);  
Assert.assertEquals(tester.get(<span class="hl-string">"#someIdForStr"</span>), <span class="hl-string">"a str"</span>);  
Assert.assertEquals(tester.get(<span class="hl-string">"#someIdForNull"</span>), null);  
Assert.assertEquals(tester.get(<span class="hl-string">"#someIdForClear"</span>), Clear);  

    </pre>
    </div></div><br class="example-break">
    
    <p>More samples can be found in <a class="ulink" href="https://github.com/astamuse/asta4d/blob/develop/asta4d-core/src/test/java/com/astamuse/asta4d/test/unit/RenderTesterTest.java" target="_top">source</a></p>
  </div>
  
</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>5.&nbsp;View first URL mapping and variable injection</h2></div></div></div>
  
  
  <p>...</p>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>6.&nbsp;Side-effect and request handler</h2></div></div></div>
  
  
  <p>...</p>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>7.&nbsp;Impement request handler and url mapping</h2></div></div></div>
  
  
  <p>...</p>

</div>
  </div>  

  <div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="asta4d-reference"></a>Part&nbsp;III.&nbsp;Reference</h1></div></div></div>
    
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>8.&nbsp;Template</h2></div></div></div>
  
  
  <p>...</p>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>9.&nbsp;Snippet</h2></div></div></div>
  
  
  <p>...</p>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>10.&nbsp;Variable injection</h2></div></div></div>
  
  
  <p>...</p>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>11.&nbsp;URL rule</h2></div></div></div>
  
  
  <p>...</p>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>12.&nbsp;Request Handler</h2></div></div></div>
  
  
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e168"></a>12.1&nbsp;Implementation</h2></div></div></div>
  
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e170"></a>12.2&nbsp;Content provider</h2></div></div></div>
  
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e172"></a>12.3&nbsp;Request handler chain</h2></div></div></div>
  
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e174"></a>12.4&nbsp;Request Interceptor</h2></div></div></div>
  
  </div>
  
</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>13.&nbsp;Extended request handler usage</h2></div></div></div>
  
  
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e178"></a>13.1&nbsp;Restful</h2></div></div></div>
  
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e180"></a>13.2&nbsp;Handle static resouce files and generic path mapping</h2></div></div></div>
  
  </div>
  
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e182"></a>13.3&nbsp;Normalize http request</h2></div></div></div>
  
  </div>
  
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e184"></a>13.4&nbsp;As MVC's Controller</h2></div></div></div>
  
  </div>

</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>14.&nbsp;i18n</h2></div></div></div>
  
  
  <p>...</p>
  
</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>15.&nbsp;Asta4dServlet and configuration</h2></div></div></div>
  
  
  <p>...</p>
  
</div>
    <div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>16.&nbsp;Integration with Spring</h2></div></div></div>
  
  
  <p>...</p>
  
</div>
  </div>  
  
</div></body></html>